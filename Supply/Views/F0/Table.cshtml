@using FNet.Supply.Models
@model F0Model
<style type="text/css">
    #supply_views_f0_table table.journal tr {
        border-left: 1px solid black;
    }

        #supply_views_f0_table table.journal tr.order-info {
            background-color: #ffff88;
        }

        #supply_views_f0_table table.journal tr.selected {
            background-color: #bbffbb;
        }

        #supply_views_f0_table table.journal tr:hover {
            background-color: #ddffdd;
        }

    #supply_views_f0_table table.journal th {
        border: 1px solid black;
        padding: 2px;
        font-weight: bold;
    }

    #supply_views_f0_table table.journal td {
        border-top: 1px solid black;
        border-right: 1px solid black;
        padding: 2px;
    }
</style>
<div id="supply_views_f0_table" style="width: 100%;">
    @if (Model != null && Model.Data != null)
    {
        F0Model.FilteredData.ItemArray prevRow = null;
        F0Model.FilteredData.ItemArray currRow = null;
        <table class="journal" style="margin: 6px;">
            <tr>
                <th>Х</th> <!-- 01 -->
                <th>№ наш</th> <!-- 02 -->
                <th>Поставщик</th> <!-- 03 -->
                <th>№ их</th> <!-- 04 -->
                <th>Состояние заказа</th> <!-- 05 -->
                <th colspan="8">Примечание</th> <!-- 06-13 -->
            </tr>
            <tr>
                <th></th> <!-- 01 -->
                <th>V</th> <!-- 02 -->
                <th colspan="4">Товар</th> <!-- 03-06 -->
                <th>Цена (т)</th> <!-- 07 -->
                <th>Кол-во (т)</th> <!-- 08 -->
                <th>Срок (т)</th> <!-- 09 -->
                <th>Менеджер</th> <!-- 10 -->
                <th>Аукцион</th> <!-- 11 -->
                <th title="дата поставки к нам на склад по спецификации">Дата</th> <!-- 12 -->
                <th>Примечание</th> <!-- 13 -->
            </tr>
            @for (int tri = 0; tri < Model.Data.Таблица.RowsCount; tri++)
            {
                var row = Model.Data.Таблица[tri];
                String цена1 = row["цена1"];
                if (цена1.Length > 4) { цена1 = цена1.Substring(0, цена1.Length - 1); }
                String количество1 = row["количество1"];
                if (количество1.Length > 4) { количество1 = количество1.Substring(0, количество1.Length - 4); }
                String срок_годности1 = row["срок_годности1"];
                if (срок_годности1.Length == 8) { срок_годности1 = срок_годности1.Substring(3, 5); }
                <tr class="goods-info not-in-order" data-order_table_uid="@row["uid"]">
                    <td style="border-top: none; border-right: none;"></td> <!-- 01 -->
                    <td style="border-top: none;"><input type="checkbox" name="выбрано" data-modified="0" /></td> <!-- 02 -->
                    <td colspan="4">@row["товар_описание"]</td> <!-- 03-06 -->
                    <td style="text-align: right" onclick="SupplyViewsF0Index.showTableDetail(this);">@цена1</td> <!-- 07 -->
                    <td style="text-align: right" onclick="SupplyViewsF0Index.showTableDetail(this);">@количество1</td> <!-- 08 -->
                    <td style="text-align: right" onclick="SupplyViewsF0Index.showTableDetail(this);">@срок_годности1</td> <!-- 09 -->
                    <td>@row["товар_спецификация_менеджер"]</td> <!-- 10 -->
                    <td>@row["аукцион_номер"]</td> <!-- 11 -->
                    <td style="text-align: right">@row["дата_поставки"]</td> <!-- 12 -->
                    <td onclick="SupplyViewsF0Index.showTableDetail(this);">@row["товар_примечание"]</td> <!-- 13 -->
                </tr>
            }
            @for (int hri = 0; hri < Model.Data.Шапка.RowsCount; hri++)
            {
                var row = Model.Data.Шапка[hri];
                <tr class="order-info" data-order_head_uid="@row["uid"]">
                    @if (row["обработано"] == "True")
                    {
                        <td style="border-right: none;">
                            <input type="checkbox" name="обработано" data-modified="0" checked="checked" />
                        </td> <!-- 01 -->
                    }
                    else
                    {
                        <td style="border-right: none;">
                            <input type="checkbox" name="обработано" data-modified="0" />
                        </td> <!-- 01 -->
                    }
                    <td style="text-align: right;">@row["id"]</td> <!-- 02 -->
                    <td>
                        @RenderPage("~/Views/F0/TableFieldSelect.cshtml",
                            new { IdFieldName = "поставщик",
                                  IdFieldValue = row["поставшик"],
                                  Value = row["поставщик_наименование"] })
                    </td> <!-- 03 -->
                    <td onclick="SupplyViewsF0Index.showHeadDetail(this);">@row["номер_их"]</td> <!-- 04 -->
                    <td>
                        @RenderPage("~/Views/F0/TableFieldSelect.cshtml",
                            new { IdFieldName = "состояние",
                                  IdFieldValue = row["состояние"],
                                  Value = row["состояние_наименование"] })
                    </td> <!-- 05 -->
                    <td colspan="8" onclick="SupplyViewsF0Index.showHeadDetail(this);">@row["примечание"]</td> <!-- 06-13 -->
                </tr>
            }

            @for (Int32 i = 0; i < Model.Data.RowsCount; i++)
            {
                prevRow = currRow;
                currRow = Model.Data[i];
                if (prevRow == null || prevRow.заказ != currRow.заказ)
                {
                    <tr class="order-info" data-order_head_uid="@currRow.заказ">
                        @if (currRow.заказ_обработано == "True")
                        {
                            <td style="border-right: none;"><input type="checkbox" name="обработано" data-modified="0" checked="checked" /></td> <!-- 01 -->
                        }
                        else
                        {
                            <td style="border-right: none;"><input type="checkbox" name="обработано" data-modified="0" /></td> <!-- 01 -->
                        }
                        <td style="text-align: right;">@currRow.заказ_номер</td> <!-- 02 -->
                        <td>
                            @RenderPage("~/Views/F0/TableFieldSelect.cshtml", new { CurrRow = currRow, IdField = "заказ_поставщик", NameField = "заказ_поставщик_наименование" })
                        </td> <!-- 03 -->
                        <td onclick="SupplyViewsF0Index.showHeadDetail(this);">@currRow.заказ_номер_их</td> <!-- 04 -->
                        <td>
                            @RenderPage("~/Views/F0/TableFieldSelect.cshtml", new { CurrRow = currRow, IdField = "заказ_состояние", NameField = "заказ_состояние_наименование" })
                        </td> <!-- 05 -->
                        <td colspan="8" onclick="SupplyViewsF0Index.showHeadDetail(this);">@currRow.заказ_примечание</td> <!-- 06-13 -->
                    </tr>
                }
                <tr class="goods-info" data-order_table_uid="@currRow.заказы_у_поставщиков_таблица__uid">
                    <td style="border-top: none; border-right: none;"></td> <!-- 01 -->
                    <td style="border-top: none;"><input type="checkbox" name="выбрано" data-modified="0" /></td> <!-- 02 -->
                    <td colspan="4">@currRow.товар_описание</td> <!-- 03-06 -->
                    <td style="text-align: right" onclick="SupplyViewsF0Index.showTableDetail(this);">@currRow.товар_цена1</td> <!-- 07 -->
                    <td style="text-align: right" onclick="SupplyViewsF0Index.showTableDetail(this);">@currRow.товар_количество1</td> <!-- 08 -->
                    <td style="text-align: right" onclick="SupplyViewsF0Index.showTableDetail(this);">@currRow.товар_срок_годности1</td> <!-- 09 -->
                    <td>@currRow.товар_спецификация_менеджер</td> <!-- 10 -->
                    <td>@currRow.аукцион_номер</td> <!-- 11 -->
                    <td style="text-align: right">@currRow.товар_дата_поставки</td> <!-- 12 -->
                    <td onclick="SupplyViewsF0Index.showTableDetail(this);">@currRow.товар_примечание</td> <!-- 13 -->
                </tr>
            }
            <tr style="border: 1px solid black"></tr>
        </table>
    }
</div>
<script type="text/javascript">
    var SupplyViewsF0Table = (function () {
        let mainDiv = $('#supply_views_f0_table');
        let ordersMode = false;
        //setMode();
        mainDiv.find('input[type="checkbox"]').click(function () {
            $(this).attr('data-modified', '1');
        });
        function setMode() {
            let flag = false;
            mainDiv.find('tr').each(function (index, element) {
                let tr = $(element);
                if (tr.hasClass('order-info')) {
                    if (tr.attr('data-order_head_uid')) {
                        if (ordersMode) { tr.show(); } else { tr.hide(); }
                        flag = ordersMode;
                    } else {
                        tr.hide();
                        flag = !ordersMode;
                    }
                }
                if (tr.hasClass('goods-info')) {
                    if (flag) { tr.show(); } else { tr.hide(); }
                }
            });
        }
        return {
            setOrdersMode: function (mode) {
                ordersMode = mode;
                setMode();
            }
        };
    })();
</script>
